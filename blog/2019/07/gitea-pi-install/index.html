<!DOCTYPE html>
<html lang="en">
<head>

  
  <meta charset="utf-8">
  <title>Giteaをインストール | goozenlab</title>
  <meta name="description" content="">
  <meta name="author" content="jin">
  
<meta name="viewport" content="width=device-width, initial-scale=1">







<link rel="stylesheet" href="https://unpkg.com/purecss@1.0.0/build/pure-min.css" integrity="sha384-nn4HPE8lTHyVtfCBi5yW9d20FjT8BJwUXyWZT9InLYax14RDjBj46LmSztkmNP9w" crossorigin="anonymous">


  <link rel="stylesheet" href="https://unpkg.com/purecss@1.0.0/build/grids-responsive-min.css">

<link rel="stylesheet" href="https://goozenlab.github.io/css/custom.css">


<link rel="shortcut icon" href="https://goozenlab.github.io//img/favicon.ico" type="image/x-icon">



<script async src="https://www.googletagmanager.com/gtag/js?id=UA-125185379-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-125185379-1');
</script>

  

<link rel="stylesheet" href="https://goozenlab.github.io/highlight/styles/atom-one-dark.css">

<script src="https://goozenlab.github.io/highlight/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>



<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-4562670868665621",
          enable_page_level_ads: true
     });
</script>



 
</head>
<body>

<div class="header pure-g">
    <div class="pure-u-1-24 pure-u-md-2-24"></div>
    <div class="pure-u-11-12 pure-u-md-21-24">
        <div class="desktop pure-menu pure-menu-horizontal nav-menu">
            
            <a href="https://goozenlab.github.io/" class="site-title pure-menu-heading">goozenlab</a>
            <ul class="pure-menu-list pull-right">
                
                <li class="pure-menu-item pure-menu-has-children pure-menu-allow-hover">
                    <a href="#" id="menuLink1" class="pure-menu-link">projects</a>
                    <ul class="pure-menu-children">
                        <li class="pure-menu-item"><a
                                href="https://goozenlab.github.io/computing/opensource-network-environment/"
                                class="pure-menu-link">openSource network environment</a></li>
                        <li class="pure-menu-item"><a href="https://goozenlab.github.io/computing/home-pi/"
                                class="pure-menu-link">home pi server</a></li>
                        <li class="pure-menu-item"><a href="https://goozenlab.github.io/computing/travel-pi/"
                                class="pure-menu-link">travel pi router</a></li>
                        <li class="pure-menu-item"><a href="https://goozenlab.github.io/computing/tpt480s/"
                                class="pure-menu-link">multi-os thinkpad t480s</a></li>
                        <li class="pure-menu-item"><a href="https://goozenlab.github.io/computing/tpt480s-hackintosh/"
                                class="pure-menu-link">make hackintosh t480s</a></li>
                        <li class="pure-menu-item"><a href="https://goozenlab.github.io/computing/nomad-stick-machine/"
                                class="pure-menu-link">nomad stick machine</a></li>
                        <li class="pure-menu-item"><a href="https://goozenlab.github.io/computing/ryzentosh/"
                                class="pure-menu-link">ryzentosh itx</a></li>
                        <li class="pure-menu-item"><a href="https://goozenlab.github.io/computing/vaiop-reloaded/"
                                class="pure-menu-link">vaio-P reloaded: 2019</a></li>
                        <li class="pure-menu-item"><a href="https://goozenlab.github.io/computing/optout-phone/"
                                class="pure-menu-link">optout phone</a></li>
                        <li class="pure-menu-item"><a href="https://goozenlab.github.io/computing/ipod-here-now/"
                                class="pure-menu-link">ipod reborn</a></li>
                    </ul>
                </li>
                
                <li class="pure-menu-item pure-menu-has-children pure-menu-allow-hover">
                    <a href="#" id="menuLink1" class="pure-menu-link">iapps</a>
                    <ul class="pure-menu-children">
                        <li class="pure-menu-item"><a href="https://goozenlab.github.io/iapp/littlist/"
                                class="pure-menu-link">littlist</a></li>
                        <li class="pure-menu-item"><a href="https://goozenlab.github.io/iapp/sati/"
                                class="pure-menu-link">sati</a></li>
                        <li class="pure-menu-item"><a href="https://goozenlab.github.io/iapp/dandori/"
                                class="pure-menu-link">dandori</a></li>
                        <li class="pure-menu-item"><a href="https://goozenlab.github.io/iapp/ohayo/"
                                class="pure-menu-link">ohayo</a></li>
                        <li class="pure-menu-item"><a href="https://goozenlab.github.io/iapp/cosper/"
                                class="pure-menu-link">cosper</a></li>
                        <li class="pure-menu-item"><a href="https://goozenlab.github.io/iapp/doop/"
                                class="pure-menu-link">doop</a></li>
                        <li class="pure-menu-item"><a href="https://goozenlab.github.io/iapp/tapas/"
                                class="pure-menu-link">tapas</a></li>
                    </ul>
                </li>
                <li class="pure-menu-item">
                    <a href="https://goozenlab.github.io/tags/update/" class="pure-menu-link">update</a>
                </li>
                <li class="pure-menu-item">
                    <a href="https://goozenlab.github.io/about/" class="pure-menu-link">about</a>
                </li>
            </ul>
        </div>
        <div class="mobile pure-menu nav-menu">
            <a href="/" class="pure-menu-heading" id="toggle-home">goozenlab</a>
            <a href="#" id="toggle-btn">&#9776;</a>
            <ul class="pure-menu-list" id="toggle-content" style="display:none;">
                
                
                <li class="pure-menu-item">
                    <a href="https://goozenlab.github.io/categories/develop/" class="pure-menu-link">dev</a>
                </li>
                <li class="pure-menu-item">
                    <a href="https://goozenlab.github.io/categories/update/" class="pure-menu-link">update</a>
                </li>
                <li class="pure-menu-item">
                    <a href="https://goozenlab.github.io/categories/goods/" class="pure-menu-link">goods</a>
                </li>
                <li class="pure-menu-item">
                    <a href="https://goozenlab.github.io/categories/nomad/" class="pure-menu-link">nomad</a>
                </li>
                <li class="pure-menu-item">
                    <a href="https://goozenlab.github.io/about/" class="pure-menu-link">about</a>
                </li>
            </ul>
        </div>
    </div>
    <div class="pure-u-1-24 pure-u-md-1-24"></div>
</div>

<div class="pure-g">
    <div class="pure-u-1-24 pure-u-md-5-24"></div>
	<div class="pure-u-11-12 pure-u-md-14-24">
        <div class="post">
            <div class="post-title">
                <p class="footnote">
                    <time class="">2019-07-17</time>
		            
                    
                    |
                    
                    
                    tags:<a href="https://goozenlab.github.io/tags/raspberry-pi">raspberry pi</a> 
                    

                    
                    categories:<a href="https://goozenlab.github.io/categories/server">server</a> 
                    

                    
                </p>
                <h1>Giteaをインストール</h1>
            </div>

            <div class="post-content">
                <p>何でもセルフホスト・パイ・サーバー計画続行中です。
今回はgitlabほど仰々しくないgolangで書かれた、
gitサーバーことgiteaをインストールしました。</p>
<p><img src="/images/2019-07-12-gitea-00.png" alt="Gitea install on Pi"></p>
<p>サービスを動かすためのユーザーを作ります。<code>--disabled-password</code>のオプションをつけることでログインはできません。giteaを動かすためだけのユーザーになります。</p>
<pre><code>pi@raspberrypi:~ $ sudo -Es
root@raspberrypi:~ # sudo adduser --system --shell /bin/bash --group --disabled-password --home /home/git git
Adding system user `git' (UID 111) ...
Adding new group `git' (GID 116) ...
Adding new user `git' (UID 111) with group `git' ...
Creating home directory `/home/git' ...
</code></pre><p>そして必要なフォルダーを作成し運用環境を整えます。</p>
<pre><code>root@raspberrypi:~ # mkdir -p /var/lib/gitea/{custom,data,indexers,public,log}
root@raspberrypi:~ # chown git:git /var/lib/gitea/{data,indexers,log}
root@raspberrypi:~ # chmod 750 /var/lib/gitea/{data,indexers,log}
root@raspberrypi:~ # mkdir /etc/gitea
root@raspberrypi:~ # chown root:git /etc/gitea
root@raspberrypi:~ # chmod 770 /etc/gitea
</code></pre><h2 id="データーベースの作成">データーベースの作成</h2>
<p>giteaで使うmariaDBのデーターベースを作っておきます。</p>
<ul>
<li>DB Name: gitea_db</li>
<li>DB user/passwd: gitea-user / git-tea-user</li>
</ul>
<p>作業は以下’の通り、</p>
<pre><code>root@raspberrypi:~ # mysql -u root
MariaDB [(none)]&gt; CREATE DATABASE gitea_db;
MariaDB [(none)]&gt; GRANT ALL PRIVILEGES ON gitea_db.* TO 'gitea-user'@'localhost' IDENTIFIED BY &quot;git-tea-user&quot;;
MariaDB [(none)]&gt; exit
</code></pre><h2 id="バイナリーのダウンロード">バイナリーのダウンロード</h2>
<p>デビアンではパッケージに登録されているも、メンテナンスはされていないようなのです。
基本的にシングル・バイナリーで動くようなので、
環境に合ったバイナリーを直接サイトよりダウンロードして使うことにします。
ラズベリーパイでは<code>arm7</code>のバイナリーは動作しないようなので、<strong>arm6</strong>のバイナリーをダウンロードします。
実行権限を追加して、<code>/usr/local/bin/</code>に移動します。</p>
<pre><code>root@raspberrypi:~ # wget -c -O gitea https://dl.gitea.io/gitea/1.8.3/gitea-1.8.3-linux-arm-6
root@raspberrypi:~ # chmod +x gitea
root@raspberrypi:~ # mv gitea /usr/local/bin/
</code></pre><p>download page : <a href="https://dl.gitea.io/gitea/">https://dl.gitea.io/gitea/</a></p>
<h2 id="systemd-サービス">Systemd サービス</h2>
<p>バイナリーを実行するためにsystemdのファイル<code>/usr/lib/systemd/system/gitea.service</code>を作ります。使っているサーバーのサービスをコメントアウトします。（RequiresもAfterにしたけれど、違いがわかりません。）</p>
<pre><code>pi@raspberrypi:~ $ sudo vi /usr/lib/systemd/system/gitea.service

[Unit]
Description=Gitea (Git with a cup of tea)
After=syslog.target
After=network.target
#Requires=mysql.service
After=mariadb.service
#Requires=postgresql.service
#Requires=memcached.service
#Requires=redis.service

[Service]
# Modify these two values and uncomment them if you have
# repos with lots of files and get an HTTP error 500 because
# of that
###
#LimitMEMLOCK=infinity
#LimitNOFILE=65535
RestartSec=2s
Type=simple
User=git
Group=git
WorkingDirectory=/var/lib/gitea/
ExecStart=/usr/local/bin/gitea web -c /etc/gitea/app.ini
Restart=always
Environment=USER=git HOME=/home/git GITEA_WORK_DIR=/var/lib/gitea
# If you want to bind Gitea to a port below 1024 uncomment
# the two values below
###
#CapabilityBoundingSet=CAP_NET_BIND_SERVICE
#AmbientCapabilities=CAP_NET_BIND_SERVICE

[Install]
WantedBy=multi-user.target 
</code></pre><p>起動時に動作するように登録して、サービスを開始します。
<code>sudo systemctl start gitea</code>にてエラーが上がっていないか動作の確認をします。</p>
<pre><code>pi@raspberrypi:~ $ sudo systemctl enable gitea
pi@raspberrypi:~ $ sudo systemctl start gitea
pi@raspberrypi:~ $ sudo systemctl start gitea
● gitea.service - Gitea (Git with a cup of tea)
   Loaded: loaded (/usr/lib/systemd/system/gitea.service; disabled; vendor preset: enabled)
   Active: active (running) since Fri 2019-07-12 11:18:42 +07; 9s ago
 Main PID: 984 (gitea)
    Tasks: 13 (limit: 2200)
   Memory: 78.3M
   CGroup: /system.slice/gitea.service
           └─984 /usr/local/bin/gitea web -c /etc/gitea/app.ini

Jul 12 11:18:42 raspberrypi systemd[1]: Started Gitea (Git with a cup of tea).
Jul 12 11:18:49 raspberrypi gitea[984]: 2019/07/12 11:18:49 Serving [::]:3000 with pid 984
</code></pre><p>無事に起動しました。</p>
<h2 id="giteaの設定">giteaの設定</h2>
<p>最初にgiteaを設定します。アクセスは、<code>http://&lt;&lt;IP_ADDRESS&gt;&gt;:3000/install</code>になります。
データベースやその他の基本設定をします。</p>
<p><img src="/images/2019-07-12-gitea-conf-01.png" alt="Gitea install on Pi"></p>
<p>SSHドメインとベースURLにはIPかドメイン名を入れる必要があります。
ポート番号はgrafanaとかぶりますので、grafanaのポート番号を変更しました。
最初にログインしたユーザーが管理者になります。もしそうでない場合は、あらかじめ設定しておくのがよろしいようです。
お一人様なのでそのまま。</p>
<p><img src="/images/2019-07-12-gitea-conf-02.png" alt="Gitea install on Pi"></p>
<p>複数人で使う場合は<code>Disable Self-registration</code>のボックスはチェックしたほうが良いそうです。（勝手にアカウントを追加できないようになる）
サーバー設定以下にあったような。。
シンプルな設定になっているので、使っている環境に合わせて変えてください。</p>
<p><img src="/images/2019-07-12-gitea-conf-03.png" alt="Gitea install on Pi"></p>
<p>後々変更するには、<code>/etc/gitea/app.ini</code>のファイルを変更します。</p>
<hr>
<p>インストールが終了したのちにユーザーを登録し、サインインします。</p>
<p><img src="/images/2019-07-12-gitea-register-00.png" alt="Gitea install on Pi">
<img src="/images/2019-07-12-gitea-signin-00.png" alt="Gitea install on Pi"></p>
<p>基本githubと似てますが、ちょっとすっきりしてます。個人用途では十分に思えます。</p>
<!--![Gitea install on Pi](/images/2019-07-12-gitea-main-00.png)-->
<p><img src="/images/2019-07-12-gitea-main-01.png" alt="Gitea install on Pi"></p>
<p>外でフラフラと作業をので、回線に依存しないのはちょっとありがたいんですよね。
個人のプロジェクトはこちらに放り込もうと思ってます。
恥ずかしいコードも人に見られることもなくやりたい放題できます。</p>
<!--
## supervisorとは？

https://github.com/go-gitea/gitea/blob/master/contrib/supervisor/gitea

Using supervisor
Install supervisor by running below command in terminal:

sudo apt install supervisor

Create a log dir for the supervisor logs:

# assuming Gitea is installed in /home/git/gitea/
mkdir /home/git/gitea/log/supervisor
Open supervisor config file in a file editor:

sudo vim /etc/supervisor/supervisord.conf
Append the configuration from the sample supervisord config.

Change the user (git) and home (/home/git) settings to match the deployment environment. Change the PORT or remove the -p flag if default port is used.

Lastly enable and start supervisor at boot:

sudo systemctl enable supervisor
sudo systemctl start supervisor

-->
<!--

Setting up Nginx

I'm a big fan of Nginx as it's a rock solid piece of software and
 as such I decided to use Nginx as a reverse proxy that performs SSL termination for the Gitea server. 
 Gitea could just as easily be run with a different reverse proxy (such as Apache) or entirely standalone.


Next let's go ahead and add an enabled site entry for Gitea by creating the following enabled site file:

```
pi@raspberrypi:~ $ sudo vim /etc/nginx/sites-enabled/gitea

server {
    listen 80;
    server_name <your-domain>;

    location / {
        proxy_pass http://localhost:3000;
    }

    proxy_set_header X-Real-IP $remote_addr;
}
```

This sets up a listener that listens on port 80 and reverse proxies to the local port 3000 where Gitea will be running. 
Additionally we're adding the proxy_set_header here 
so that we can get accurate remote ip addresses in the Gitea logs which we'll use later for fail2ban.

Also, don't panic that we've only added a listener for port 80,
we'll soon be using let's encrypt to create an SSL certificate 
 and rewrite this listener to enforce HTTPS for all traffic.

Finally let's go ahead and remove the default enabled site and reload the configuration:

pi@raspberrypi:~ $ sudo rm /etc/nginx/sites-enabled/default
pi@raspberrypi:~ $ sudo service nginx reload

Once this is done, you should be able to manually start your Gitea server 
and visit it on port 80 to see the Gitea interface.
-->

				

<h3>See Also</h3>
<ul>
	
	<li><a href="/blog/2019/07/tt-rss-pi-install/">TinyTiny RSSをインストール</a></li>
	
	<li><a href="/blog/2019/07/pi-full-backup/">パイ・フルバックアップ</a></li>
	
	<li><a href="/blog/2019/07/pi-lamp-install/">LMAPをインストール</a></li>
	
	<li><a href="/blog/2019/07/pi-save-power/">パイ省エネ設定</a></li>
	
	<li><a href="/blog/2019/07/pi-nfs/">NFS on Pi</a></li>
	
</ul>


            </div>
       		
			<div class="post-content">
       	 		
       		</div>
            
        </div>
	</div>
    <div class="pure-u-1-24 pure-u-md-5-24"></div>
</div>


<div class="footer pure-g">
    <div class="pure-u-1-24 pure-u-md-3-24"></div>
    <div class="pure-u-11-12 pure-u-md-20-24">
		<div style="margin-top:-26px; margin-left:-13px;"><img src="/images/site/footer-owl.png" alt="Owl" /></div>
        <div class="footer-content">
 		  <div class="pure-menu pure-menu-horizontal">
              <ul>







			      
                  <li class="pure-menu-heading" id="foot-name">Jin K.:</li>
                  

                  
                  <li class="pure-menu-item">
                      <a href="mailto:goozenlab@gmail.com" class="pure-menu-link">Email</a>
                  </li>
                  

                  

                  

                  

                  
                  <li class="pure-menu-item">
                      <a href="https://twitter.com/goozenlab" class="pure-menu-link">Twitter</a>
                  </li>
                  
              </ul>
              <a href="#" class="pure-menu-heading pull-right" id="gototop-btn">↑↑</a>
          </div>
		  
		  <p id="foot-copyright">Copyright 2019, goozenlab; all rights reserved.</p>
		  
		</div>
      <div class="pure-u-1-24 pure-u-md-1-24"></div>
</div>


<script src="https://goozenlab.github.io/js/jquery.min.js" type="text/javascript"></script>
<script src="https://goozenlab.github.io/js/jquery.timeago.js" type="text/javascript"></script>
<script type="text/javascript">
  $(function(){
    $("time.timeago").timeago();
  })
  $("#toggle-btn").click(function(){
    $("#toggle-content").toggle();
    if($(this).html() === "☰") {
        $(this).html("X")
    } else {
        $(this).html("☰")
    }
  });
  $(window).resize(function(){
    if(window.innerWidth > 768) {
      $(".desktop").removeAttr("style");
    }
  });
</script>



</body>
</html>



