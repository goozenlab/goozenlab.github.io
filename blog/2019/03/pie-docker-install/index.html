<!DOCTYPE html>
<html lang="en">
<head>

  
  <meta charset="utf-8">
  <title>Docker on R. Pie Zero | goozenlab</title>
  <meta name="description" content="">
  <meta name="author" content="jin">
  
<meta name="viewport" content="width=device-width, initial-scale=1">


<link href="//fonts.googleapis.com/css?family=Raleway:400,300,600" rel="stylesheet" type="text/css">
<link rel="stylesheet" href="https://goozenlab.com/css/fonts.css">

<script src="https://use.fontawesome.com/e735766989.js"></script>


<link rel="stylesheet" href="https://unpkg.com/purecss@1.0.0/build/pure-min.css" integrity="sha384-nn4HPE8lTHyVtfCBi5yW9d20FjT8BJwUXyWZT9InLYax14RDjBj46LmSztkmNP9w" crossorigin="anonymous">


  <link rel="stylesheet" href="https://unpkg.com/purecss@1.0.0/build/grids-responsive-min.css">

<link rel="stylesheet" href="https://goozenlab.com/css/custom.css">


<link rel="shortcut icon" href="https://goozenlab.com//img/favicon.ico" type="image/x-icon">



<script async src="https://www.googletagmanager.com/gtag/js?id=UA-125185379-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-125185379-1');
</script>

  

<link rel="stylesheet" href="https://goozenlab.com/highlight/styles/atom-one-dark.css">

<script src="https://goozenlab.com/highlight/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>



<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-4562670868665621",
          enable_page_level_ads: true
     });
</script>



 
</head>
<body>

<div class="header pure-g">
    <div class="pure-u-1-24 pure-u-md-2-24"></div>
    <div class="pure-u-11-12 pure-u-md-21-24">
        <div class="desktop pure-menu pure-menu-horizontal nav-menu">
            
            <a href="https://goozenlab.com/" class="site-title pure-menu-heading">goozenlab</a>
            <ul class="pure-menu-list pull-right">
				
                <li class="pure-menu-item">
                    <a href="https://goozenlab.com/tags/update/" class="pure-menu-link">update</a>
                </li>
                
                <li class="pure-menu-item pure-menu-has-children pure-menu-allow-hover">
					<a href="#" id="menuLink1" class="pure-menu-link">iapps</a>
					<ul class="pure-menu-children">
						<li class="pure-menu-item"><a href="https://goozenlab.com/iapp/littlist/" class="pure-menu-link">littlist</a></li>
						<li class="pure-menu-item"><a href="https://goozenlab.com/iapp/sati/" class="pure-menu-link">sati</a></li>
                		<li class="pure-menu-item"><a href="https://goozenlab.com/iapp/dandori/" class="pure-menu-link">dandori</a></li>
                		<li class="pure-menu-item"><a href="https://goozenlab.com/iapp/ohayo/" class="pure-menu-link">ohayo</a></li>
                		<li class="pure-menu-item"><a href="https://goozenlab.com/iapp/cosper/" class="pure-menu-link">cosper</a></li>
                		<li class="pure-menu-item"><a href="https://goozenlab.com/iapp/doop/" class="pure-menu-link">doop</a></li>
                		<li class="pure-menu-item"><a href="https://goozenlab.com/iapp/tapas/" class="pure-menu-link">tapas</a></li>
            		</ul>
        		</li>
                <li class="pure-menu-item">
                    <a href="https://goozenlab.com/about/" class="pure-menu-link">about</a>
                </li>
            </ul>
        </div>
        <div class="mobile pure-menu nav-menu">
            <a href="/" class="pure-menu-heading" id="toggle-home">goozenlab</a>
            <a href="#" id="toggle-btn">&#9776;</a>
            <ul class="pure-menu-list" id="toggle-content" style="display:none;">
                
				
                <li class="pure-menu-item">
                    <a href="https://goozenlab.com/categories/develop/" class="pure-menu-link">dev</a>
                </li>
                <li class="pure-menu-item">
                    <a href="https://goozenlab.com/categories/update/" class="pure-menu-link">update</a>
                </li>
                <li class="pure-menu-item">
                    <a href="https://goozenlab.com/categories/goods/" class="pure-menu-link">goods</a>
                </li>
                <li class="pure-menu-item">
                    <a href="https://goozenlab.com/categories/nomad/" class="pure-menu-link">nomad</a>
                </li>
                <li class="pure-menu-item">
                    <a href="https://goozenlab.com/about/" class="pure-menu-link">about</a>
                </li>
            </ul>
        </div>
    </div>
    <div class="pure-u-1-24 pure-u-md-1-24"></div>
</div>


<div class="pure-g">
    <div class="pure-u-1-24 pure-u-md-5-24"></div>
	<div class="pure-u-11-12 pure-u-md-14-24">
        <div class="post">
            <div class="post-title">
                <p class="footnote">
                    <time class="">2019-03-03</time>
		            
                    
                    |
                    
                    
                    tags:<a href="https://goozenlab.com/tags/raspberry-pie">raspberry pie</a> <a href="https://goozenlab.com/tags/nomad">nomad</a> 
                    

                    
                    categories:<a href="https://goozenlab.com/categories/server">server</a> 
                    

                    
                </p>
                <h1>Docker on R. Pie Zero</h1>
            </div>

            <div class="post-content">
                <p><code>sudo apt-get install docker-ce=18.06.1~ce~3-0~raspbian</code></p>

<p>で、あっちに行って、こっちに行ってと、よーーーーーやく、動きました。
(ちゅーのは、ぬか喜びでした。。）</p>

<pre><code>pi@raspberrypi:~ $ apt list -a docker-ce  
Listing... Done  
docker-ce/stretch 5:18.09.0~3-0~raspbian-stretch armhf [upgradable from: 18.06.1~ce~3-0~raspbian]
docker-ce/stretch 18.06.3~ce~3-0~raspbian armhf  
docker-ce/stretch,now 18.06.1~ce~3-0~raspbian armhf [installed,upgradable to: 5:18.09.0~3-0~raspbian-stretch]
docker-ce/stretch 18.06.0~ce~3-0~raspbian armhf  
docker-ce/stretch 18.03.0~ce-0~raspbian armhf  
docker-ce/stretch 17.12.0~ce-0~raspbian armhf
</code></pre>

<p>バージョンを下げたドッカーをインストールして使える様に。。。
（たぶんPi3とかでエラーが出ている人には参考になるかも。）
結局、今のバージョン18.09.0は問題があるようで、次の18.09.1ビルドでパッチが当てられるとのこと、。</p>

<p>見よ、紆余曲折なエラーのオンパレードを。。</p>

<pre><code>pi@raspberrypi:~ $ journalctl -u docker.service
-- Logs begin at Sat 2019-03-02 10:59:48 GMT, end at Sat 2019-03-02 11:10:52 GMT. --
Mar 02 11:00:09 raspberrypi systemd[1]: Starting Docker Application Container Engine...
Mar 02 11:00:12 raspberrypi systemd[1]: Stopped Docker Application Container Engine.
Mar 02 11:07:14 raspberrypi systemd[1]: Starting Docker Application Container Engine...
Mar 02 11:07:17 raspberrypi systemd[1]: docker.service: Main process exited, code=dumped, status=11/SEGV
Mar 02 11:07:17 raspberrypi systemd[1]: Stopped Docker Application Container Engine.
Mar 02 11:07:17 raspberrypi systemd[1]: docker.service: Unit entered failed state.
Mar 02 11:07:17 raspberrypi systemd[1]: docker.service: Failed with result 'core-dump'.
Mar 02 11:10:49 raspberrypi systemd[1]: Starting Docker Application Container Engine...
Mar 02 11:10:52 raspberrypi systemd[1]: docker.service: Main process exited, code=dumped, status=11/SEGV
Mar 02 11:10:52 raspberrypi systemd[1]: Stopped Docker Application Container Engine.
Mar 02 11:10:52 raspberrypi systemd[1]: docker.service: Unit entered failed state.
Mar 02 11:10:52 raspberrypi systemd[1]: docker.service: Failed with result 'core-dump'.

+++++++

Setting up docker-ce (18.06.3~ce~3-0~debian) ...
Created symlink /etc/systemd/system/multi-user.target.wants/docker.service → /lib/systemd/system/docker.service.
Created symlink /etc/systemd/system/sockets.target.wants/docker.socket → /lib/systemd/system/docker.socket.
Job for docker.service failed because a fatal signal was delivered causing the control process to dump core.
See &quot;systemctl status docker.service&quot; and &quot;journalctl -xe&quot; for details.
invoke-rc.d: initscript docker, action &quot;start&quot; failed.
● docker.service - Docker Application Container Engine
   Loaded: loaded (/lib/systemd/system/docker.service; enabled; vendor preset: enabled)
   Active: activating (start) since Sat 2019-03-02 11:48:14 GMT; 355ms ago
     Docs: https://docs.docker.com
 Main PID: 1414 (dockerd)
      CPU: 158ms
   CGroup: /system.slice/docker.service
           └─1414 /usr/bin/dockerd -H fd://

Mar 02 11:48:14 raspberrypi systemd[1]: Starting Docker Application Container Engine...
dpkg: error processing package docker-ce (--configure):
 subprocess installed post-installation script returned error exit status 1
 
+++++++

nvoke-rc.d: initscript docker, action &quot;start&quot; failed.
● docker.service - Docker Application Container Engine
   Loaded: loaded (/lib/systemd/system/docker.service; enabled; vendor preset: enabled)
   Active: activating (start) since Sat 2019-03-02 11:57:33 GMT; 184ms ago
     Docs: https://docs.docker.com
 Main PID: 2819 (dockerd)
      CPU: 70ms
   CGroup: /system.slice/docker.service
           └─2819 /usr/bin/dockerd -H fd://

Mar 02 11:57:33 raspberrypi systemd[1]: Starting Docker Application Container Engine...
dpkg: error processing package docker-ce (--configure):
 subprocess installed post-installation script returned error exit status 1
Processing triggers for systemd (232-25+deb9u9) ...

+++++++

● docker.service - Docker Application Container Engine
   Loaded: loaded (/lib/systemd/system/docker.service; enabled; vendor preset: enabled)
   Active: deactivating (stop-sigterm)
     Docs: https://docs.docker.com
 Main PID: 4855 (dockerd)
      CPU: 493ms
   CGroup: /system.slice/docker.service
           ‣ 4855 [dockerd]
</code></pre>

<p>さて、本来はDockerのインストール方法は本家のサイトで詳しく説明されています。
<a href="https://docs.docker.com/install/linux/docker-ce/debian/">Get Docker CE for Debian</a>
ラズベリーパイにおいては、今のところはスクリプトを使ってインストールする方法を薦めています。</p>

<p>For Raspbian, installing using the repository is not yet supported. You must instead use the <a href="https://docs.docker.com/install/linux/docker-ce/debian/#install-using-the-convenience-script">convenience script</a>.</p>

<p>まぁ、なんとも簡単で、以下の２つのスクリプトで導入できるはずですが、、、</p>

<pre><code>pi@raspberrypi:~ $ curl -fsSL https://get.docker.com -o get-docker.sh
pi@raspberrypi:~ $ sudo sh get-docker.sh
</code></pre>

<p>上記の様なエラーのオンパレード、下記のエラー情報を見つつ試行錯誤しました。</p>

<ul>
<li><a href="https://raspberrypi.stackexchange.com/questions/94220/unable-to-get-docker-to-run/94221">https://raspberrypi.stackexchange.com/questions/94220/unable-to-get-docker-to-run/94221</a></li>
<li><a href="https://github.com/docker/for-linux/issues/490">https://github.com/docker/for-linux/issues/490</a></li>
<li><a href="https://stackoverflow.com/questions/53258109/how-to-mention-specific-version-while-installing-docker-on-raspberry-pi">https://stackoverflow.com/questions/53258109/how-to-mention-specific-version-while-installing-docker-on-raspberry-pi</a></li>
</ul>

<p>最終的に、動作確認の取れている以前のバージョンをインストールする方法で収まりました。</p>

<p>まず、Docker’s official GPG keyを所得します。注意：<strong>debian</strong>ではなく<strong>raspbian</strong>です。</p>

<pre><code>pi@raspberrypi:~ $ curl -fsSL https://download.docker.com/linux/raspbian/gpg | sudo apt-key add -
</code></pre>

<p>そして、新しいファイル<code>docker.list</code>を/etc/apt/sources.list.d/に追加します。docker.listにレポジトリー先を書き込みます。</p>

<pre><code>deb [arch=armhf] https://download.docker.com/linux/raspbian stretch stable
</code></pre>

<p>aptを更新します。そしてバージョンのリストを見て、指定したバージョン、動作確認の取れている18.06.1をインストールします。（こんなやり方があるもの驚きで、知らなかった。apt 恐るべし。）</p>

<pre><code>pi@raspberrypi:~ $ sudo apt update
pi@raspberrypi:~ $ apt list -a docker-ce
Listing... Done
docker-ce/stretch 5:18.09.0~3-0~raspbian-stretch armhf
docker-ce/stretch 18.06.3~ce~3-0~raspbian armhf
docker-ce/stretch 18.06.1~ce~3-0~raspbian armhf
docker-ce/stretch 18.06.0~ce~3-0~raspbian armhf
docker-ce/stretch 18.03.1~ce-0~raspbian armhf
docker-ce/stretch 18.03.0~ce-0~raspbian armhf
docker-ce/stretch 17.12.1~ce-0~raspbian armhf
docker-ce/stretch 17.12.0~ce-0~raspbian armhf

pi@raspberrypi:~ $ sudo apt-get install docker-ce=18.06.1~ce~3-0~raspbian

...........
Setting up pigz (2.3.4-1) ...
Setting up docker-ce (18.06.1~ce~3-0~raspbian) ...
Created symlink /etc/systemd/system/multi-user.target.wants/docker.service → /lib/systemd/system/docker.service.
Created symlink /etc/systemd/system/sockets.target.wants/docker.socket → /lib/systemd/system/docker.socket.
Setting up aufs-dkms (4.9+20161219-1) ...
Examining /etc/kernel/header_postinst.d.
run-parts: executing /etc/kernel/header_postinst.d/dkms 3.6-trunk-rpi
Error!  The dkms.conf for this module includes a BUILD_EXCLUSIVE directive which
does not match this kernel/arch.  This indicates that it should not be built.
.........
</code></pre>

<p>他のところで、エラーが出ているけれど、ようやくのことインストール出来ました。</p>

<p>で、まずは、今までインストールできず仕舞いだった、こちらもエラー三昧のGrafinaをインストールを試みてます。
今度は回線が不安定でセッションが.何度も切られる。。。</p>

<pre><code>pi@raspberrypi:~ $ sudo docker pull grafana/grafana
Using default tag: latest
latest: Pulling from grafana/grafana
9c38b5a8a4d5: Extracting [=================================&gt;   ]  18.28MB/19.29MB
7004aec2d325: Download complete
80f0651468b4: Download complete
c78653e72a05: Downloading [========================&gt;                 ]  18.73MB/29.38MB
b7224c5e7d13: Download complete
d0bc3461ab2a: Download complete
read tcp 192.168.1.120:46572-&gt;104.18.121.25:443: read: connection reset by peer
</code></pre>

<p>でドキュメントをみると確認で使われる、<code>sudo docker run hello-world</code>を試してみると、、、反応なし。。</p>

<pre><code>pi@raspberrypi:~ $ sudo docker run hello-world
Unable to find image 'hello-world:latest' locally
latest: Pulling from library/hello-world
c1eda109e4da: Pull complete
Digest: sha256:2557e3c07ed1e38f26e389462d03ed943586f744621577a99efb77324b0fe535
Status: Downloaded newer image for hello-world:latest
pi@raspberrypi:~ $ sudo docker run hello-world
pi@raspberrypi:~ $ sudo docker ps -a
CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS                       PORTS               NAMES
55050d44eea0        hello-world         &quot;/hello&quot;            3 minutes ago       Exited (139) 3 minutes ago                       adoring_proskuriakova
b108a2095b55        hello-world         &quot;/hello&quot;            4 minutes ago       Exited (139) 4 minutes ago                       zen_proskuriakova
pi@raspberrypi:~ $
</code></pre>

<p>ということで、何かが足りないドッカーなのですが、、Pi 3では動くとのことでまた次回、疲れた、久しぶりに徹夜してしもうた。。。このPi ZeroはArm6とArm7のどっちつかずのちょっと中途半端な輩の様なので、GPSロガーか実家のPi-Hole機にしようかなと、、。</p>

				

<h3>See Also</h3>
<ul>
	
	<li><a href="/blog/2019/03/mi-temperature-monitor/">Xiaomi 気温湿度計</a></li>
	
</ul>


            </div>
       		
			<div class="post-content">
       	 		<div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "goozenlabgh" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
       		</div>
            
        </div>
	</div>
    <div class="pure-u-1-24 pure-u-md-5-24"></div>
</div>


<div class="footer pure-g">
    <div class="pure-u-1-24 pure-u-md-3-24"></div>
    <div class="pure-u-11-12 pure-u-md-20-24">
        <div class="footer-content">
 		  <div class="pure-menu pure-menu-horizontal">
              <ul>







			      
                  <li class="pure-menu-heading" id="foot-name">Jin K.:</li>
                  

                  
                  <li class="pure-menu-item">
                      <a href="mailto:jin@goozenlab.com" class="pure-menu-link">Email</a>
                  </li>
                  

                  

                  

                  

                  
                  <li class="pure-menu-item">
                      <a href="https://twitter.com/goozenlab" class="pure-menu-link">Twitter</a>
                  </li>
                  
              </ul>
              <a href="#" class="pure-menu-heading pull-right" id="gototop-btn">↑↑</a>
          </div>
		  
		  <p id="foot-copyright">Copyright 2018, goozenlab; all rights reserved.</p>
		  
		</div>
      <div class="pure-u-1-24 pure-u-md-1-24"></div>
</div>


<script src="https://goozenlab.com/js/jquery.min.js" type="text/javascript"></script>
<script src="https://goozenlab.com/js/jquery.timeago.js" type="text/javascript"></script>
<script type="text/javascript">
  $(function(){
    $("time.timeago").timeago();
  })
  $("#toggle-btn").click(function(){
    $("#toggle-content").toggle();
    if($(this).html() === "☰") {
        $(this).html("X")
    } else {
        $(this).html("☰")
    }
  });
  $(window).resize(function(){
    if(window.innerWidth > 768) {
      $(".desktop").removeAttr("style");
    }
  });
</script>



</body>
</html>



