<!DOCTYPE html>
<html lang="en">
<head>

  
  <meta charset="utf-8">
  <title>moOdeをpi0wにインストール | goozenlab</title>
  <meta name="description" content="">
  <meta name="author" content="jin">
  
<meta name="viewport" content="width=device-width, initial-scale=1">







<link rel="stylesheet" href="https://unpkg.com/purecss@1.0.0/build/pure-min.css" integrity="sha384-nn4HPE8lTHyVtfCBi5yW9d20FjT8BJwUXyWZT9InLYax14RDjBj46LmSztkmNP9w" crossorigin="anonymous">


  <link rel="stylesheet" href="https://unpkg.com/purecss@1.0.0/build/grids-responsive-min.css">

<link rel="stylesheet" href="https://goozenlab.com/css/custom.css">


<link rel="shortcut icon" href="https://goozenlab.com//img/favicon.ico" type="image/x-icon">



<script async src="https://www.googletagmanager.com/gtag/js?id=UA-125185379-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-125185379-1');
</script>

  

<link rel="stylesheet" href="https://goozenlab.com/highlight/styles/atom-one-dark.css">

<script src="https://goozenlab.com/highlight/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>



<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-4562670868665621",
          enable_page_level_ads: true
     });
</script>



 
</head>
<body>

<div class="header pure-g">
    <div class="pure-u-1-24 pure-u-md-2-24"></div>
    <div class="pure-u-11-12 pure-u-md-21-24">
        <div class="desktop pure-menu pure-menu-horizontal nav-menu">
            
            <a href="https://goozenlab.com/" class="site-title pure-menu-heading">goozenlab</a>
            <ul class="pure-menu-list pull-right">
				
                <li class="pure-menu-item">
                    <a href="https://goozenlab.com/tags/update/" class="pure-menu-link">update</a>
                </li>
                
                <li class="pure-menu-item pure-menu-has-children pure-menu-allow-hover">
					<a href="#" id="menuLink1" class="pure-menu-link">iapps</a>
					<ul class="pure-menu-children">
						<li class="pure-menu-item"><a href="https://goozenlab.com/iapp/littlist/" class="pure-menu-link">littlist</a></li>
						<li class="pure-menu-item"><a href="https://goozenlab.com/iapp/sati/" class="pure-menu-link">sati</a></li>
                		<li class="pure-menu-item"><a href="https://goozenlab.com/iapp/dandori/" class="pure-menu-link">dandori</a></li>
                		<li class="pure-menu-item"><a href="https://goozenlab.com/iapp/ohayo/" class="pure-menu-link">ohayo</a></li>
                		<li class="pure-menu-item"><a href="https://goozenlab.com/iapp/cosper/" class="pure-menu-link">cosper</a></li>
                		<li class="pure-menu-item"><a href="https://goozenlab.com/iapp/doop/" class="pure-menu-link">doop</a></li>
                		<li class="pure-menu-item"><a href="https://goozenlab.com/iapp/tapas/" class="pure-menu-link">tapas</a></li>
            		</ul>
        		</li>
                <li class="pure-menu-item">
                    <a href="https://goozenlab.com/about/" class="pure-menu-link">about</a>
                </li>
            </ul>
        </div>
        <div class="mobile pure-menu nav-menu">
            <a href="/" class="pure-menu-heading" id="toggle-home">goozenlab</a>
            <a href="#" id="toggle-btn">&#9776;</a>
            <ul class="pure-menu-list" id="toggle-content" style="display:none;">
                
				
                <li class="pure-menu-item">
                    <a href="https://goozenlab.com/categories/develop/" class="pure-menu-link">dev</a>
                </li>
                <li class="pure-menu-item">
                    <a href="https://goozenlab.com/categories/update/" class="pure-menu-link">update</a>
                </li>
                <li class="pure-menu-item">
                    <a href="https://goozenlab.com/categories/goods/" class="pure-menu-link">goods</a>
                </li>
                <li class="pure-menu-item">
                    <a href="https://goozenlab.com/categories/nomad/" class="pure-menu-link">nomad</a>
                </li>
                <li class="pure-menu-item">
                    <a href="https://goozenlab.com/about/" class="pure-menu-link">about</a>
                </li>
            </ul>
        </div>
    </div>
    <div class="pure-u-1-24 pure-u-md-1-24"></div>
</div>


<div class="pure-g">
    <div class="pure-u-1-24 pure-u-md-5-24"></div>
	<div class="pure-u-11-12 pure-u-md-14-24">
        <div class="post">
            <div class="post-title">
                <p class="footnote">
                    <time class="">2019-03-07</time>
		            
                    
                    |
                    
                    
                    tags:<a href="https://goozenlab.com/tags/raspberry-pie">raspberry pie</a> 
                    

                    
                    categories:<a href="https://goozenlab.com/categories/server">server</a> 
                    

                    
                </p>
                <h1>moOdeをpi0wにインストール</h1>
            </div>

            <div class="post-content">
                

<p>オーディオ・ラジオサーバーの<a href="http://moodeaudio.org">moOde audio player</a>をラズベリーパイ・ゼロにインストールしました。
ネット回線が貧弱な環境いるので５時間くらいかかりましたが、問題なくすっきりとインストールできました。</p>

<p>moOde Audioホームページからダウンロードするイメージ・ファイルは、回線に問題があって、
エラーが出たり、やり直そうと思っても、最初からになってしまったりと、なかなか落とせなかったので、
公式に提供されているインストール・スクリプト使って作業を行いました。</p>

<p>手元にはすでに、Raspbianのイメージファイルがあるので、それをマイクロSDカードに書き込み、
SSHでログインできる様に少し変更を加え、カードをpi０に入れて起動します。</p>

<p>インストール方法は各所にて解説されていますので、省略します。</p>

<p>そして使っている端末から（私はマックブック）<code>ssh pii@raspberrypi.local</code>でログインします。ここで、アップデートなどの作業は必要ありません。</p>

<p>以下の様にシェルスクリプトを落としてきて、実行します。</p>

<ul>
<li>sudo wget -q <a href="http://moodeaudio.org/downloads/mos/mosbuild.sh">http://moodeaudio.org/downloads/mos/mosbuild.sh</a> -O /home/pi/mosbuild.sh</li>
<li>sudo chmod +x /home/pi/mosbuild.sh</li>
<li>sudo ./mosbuild.sh</li>
</ul>

<p>最初にWifi＋環境上の基本的な設定を行います。</p>

<pre><code>****************************************************************
**
**  Moode OS Builder v2.7
**
**  Welcome to the automated process for creating the wonderful
**  custom Linux OS that runs moOde audio player.
**
**  1. You will need a Raspberry Pi running Raspbian with SSH
**  enabled and at least 2.5 GB free space on the boot SDCard.
**
**  2. The build can be written directly to the boot SDCard or
**  to a second USB-SDCard plugged into the Raspberry Pi.
**
**  WARNING: Raspbian Stretch Lite 2018-11-13 must be used if
**  building directly on the boot SDCard. It must be a fresh,
**  unmodified installation of Stretch Lite otherwise the build
**  results cannot be guaranteed.
**
**  Be sure to backup the SDCard used to boot your Pi!
**
****************************************************************

** Write OS build directly to the boot SDCard (y/n)? y

////////////////////////////////////////////////////////////////
//
// STEP 1 - Writing OS directly to boot SDCard
//
////////////////////////////////////////////////////////////////

** Do you have a backup of your boot SDCard (y/n)? y
** Enter current date (YYYY-MM-DD) 2019-03-07
** Make corrections (y/n)? n
** Options configuration:

   There are only two build options that can be configured. The
   1st is Proxy Server. Set it to 'n' unless you are certain that
   your network requires proxied access to the Internet. The 2nd
   is WiFi connection. For maximum speed and reliability set this
   to 'n' and use an Ethernet connection for the Build.

** Option 1-2: use a proxy server for Internet access (y/n)? n
** Option 2-2: use a WiFi connection instead of Ethernet (y/n)? y
** You are already connected via WiFi with these settings:
** SSID: SirruF
** Password : R9153055
** Use these settings (y/n)?y
** Configuration complete:

The Builder has completed the configuration and is now ready
to proceed with building Moode OS.

** Proceed with build (y/n)? y
** Test Internet connection
** Download helper files
** Add options to properties file
** Load properties into env
** Modify partitions
** Remove auto-resize task
** Enable familiar network interface names
mkdir: cannot create directory ‘part2/home/pi/mosbuild’: File exists
** Install main worker script
** Enable wifi unblock
** Enable script for autorun after reboot
** Change host name to moode
** Add alias commands for monitoring the build
** Flush cached disk writes
****************************************************************
**
** Base OS created on boot SDCard
**
** The Pi must be powered off then back on.
** The build will automatically continue at STEP 2 after power on.
** It can take around 1 hour to complete.
**
** The cmds mosbrief, moslog and moslast can be used to monitor
** the build via SSH. Connect to server moode, user pi, and
** password moodeaudio for SSH login.
**
****************************************************************

** Power off the Pi (y/n)? y
Connection to raspberrypi.local closed by remote host.
Connection to raspberrypi.local closed.
</code></pre>

<p>ケーブルを抜き、再起動します。
あさの6時半ごろスタート、非常に環境の悪いマンションの共有ネットにて、インストールが始まります。
再起動後ふと見ると、LEDのランプが付いていないので、心配になりましたが、動いてます。</p>

<p>再起動後のログインは設定が変更されていて、以下の様になります。</p>

<ul>
<li>host： moode.local</li>
<li>user： pi</li>
<li>pass： moodeaudio</li>
</ul>

<pre><code>gallo:~ jin$ ssh pi@moode.local
</code></pre>

<p>何もなかった様に繋がります。裏ではインストール作業が行われています。
インストールの経過を見るために幾つかのコマンド（mosbrief, moslast, moslog）が用意されています。</p>

<pre><code>pi@moode:~ $ mosbrief
// STEP 2 - Direct build so no need to expand Root partition
// STEP 3A - Install core packages
// STEP 3B - Install core packages
** Error: Install failed
** Error: image build exited
** Error: reboot to resume the build
// STEP 3B - Install core packages
// STEP 4 - Install enhanced networking
（エラーやステップ毎の経過が表示されます。）

pi@moode:~ $ moslast
** Thu Mar 7 06:26:45 +07 2019
////////////////////////////////////////////////////////////////
//
// STEP 2 - Direct build so no need to expand Root partition
//
////////////////////////////////////////////////////////////////

** Change password for user pi to moodeaudio
** Download latest moOde release
（ログの終わり部分が表示されます。）

pi@moode:~ $ moslog
configure: WARNING: random deadlocks (bluez-alsa PCM plugin is affected).
configure: WARNING: Either compile alsa-lib without this feature or export
configure: WARNING: LIBASOUND_THREAD_SAFE=0 while using bluealsa PCM.
make  all-recursive
make[1]: Entering directory '/home/pi/mosbuild/bluez-alsa-master/build'
make[2]: Nothing to be done for 'install-data-am'.
make[2]: Leaving directory '/home/pi/mosbuild/bluez-alsa-master/build'
make[1]: Leaving directory '/home/pi/mosbuild/bluez-alsa-master/build'
** Check for default bluealsa.service file
** Creating default bluealsa.service file
** Disable bluetooth services
Synchronizing state of bluetooth.service with SysV service script with /lib/systemd/systemd-sysv-install.
Executing: /lib/systemd/systemd-sysv-install disable bluetooth
Removed /etc/systemd/system/dbus-org.bluez.service.
（延々とログが書き出されていきます。）
</code></pre>

<p>途中エラーのため、手動でリブートする必要がありました。
おかしいと思ったら<code>mosbrief or moslog</code>で状況を確認してください。
aptでファイルをインストールしたり、スクリプトで、makeをしたりと、
割と大忙しなインストール作業です。</p>

<p>インストールが終了したら。リブートされます。
10時半ごろ終了しました。以下、インストールの詳細。
幾つかエラーが出て、やり直したりしてます。</p>

<pre><code>pi@moode:~ $ mosbrief
// STEP 2 - Direct build so no need to expand Root partition
// STEP 3A - Install core packages
// STEP 3B - Install core packages
** Error: Install failed
** Error: image build exited
** Error: reboot to resume the build
// STEP 3B - Install core packages
// STEP 4 - Install enhanced networking
** Compile bluez
** Compile bluez-alsa
// STEP 5 - Install Rotary encoder driver
** Compile WiringPi
** Compile rotary encoder driver
// STEP 6 - Compile and install MPD
** Error: install failed
** Error: image build exited
** Error: reboot to resume the build
// STEP 5 - Install Rotary encoder driver
** Compile WiringPi
** Compile rotary encoder driver
// STEP 6 - Compile and install MPD
// STEP 7 - Create moOde runtime environment
// STEP 8 - Install moOde sources and configs
// STEP 9 - Alsaequal
** STEP 10 - Squashfs option not selected
// STEP 11 - Optionally, install updated Linux Kernel
pi@moode:~ $
</code></pre>

<p>お使いのブラウザーより、割り当てられているアドレスにアクセスします。
随分、シンプルな画面です。右上の<strong>m⋎</strong>より設定。下部中央が画面の切り替えになっています。</p>

<p><img src="/images/2019-03-07-moode-main.png" alt="moOde" /></p>

<p>そして、rpi0w端末の仕事っぷりをチェック。プロセスもさほど取られていない様なので、ちょっと他のサービスも裏で走れてしまおうかなとか思ってます。</p>

<p><img src="/images/2019-03-07-moode-top.png" alt="top on rp0w" /></p>

<p>そして、このrp0wにはオーディオジャックが付いていないことに気づく。。</p>

<hr />

<h3 id="bt接続">BT接続</h3>

<p>手元に香港小米家で買った、小米藍牙音頻接收器ことBT Audio Recieverを持っているのに気付き、設定を行いました。中国語、で何かしら喋ります。香港で買ったものだから、広東語だと思う。。。変更は不可の様です。</p>

<p><img src="/images/2019-03-07-mi-bt-reciever.png" alt="BT Audio Reciever" /></p>

<p>さて、何れにせよ、設定を行ってみました。右上のmより始めます。configurationをクリック。</p>

<p><img src="/images/2019-03-07-config.png" alt="" /></p>

<p>そして、システムより（確か）、ブルートゥースの有効化をします。
そうすると（確か）、画面上にBlueZというアイコンが表示されると思います。</p>

<p><img src="/images/2019-03-07-bt-setting.png" alt="" /></p>

<p>設定より、下のオーディオ・アウトプットをブルートゥース経由に変更します。
まずはスキャンをして、レシーバーを探します。そしてペアリングをして終了。</p>

<p><img src="/images/2019-03-07-bt-scan.png" alt="" />
<img src="/images/2019-03-07-bt-connect.png" alt="" /></p>

<p>なんか中国語で喋ってる、、</p>

<p><img src="/images/2019-03-07-moode-playing.png" alt="" /></p>

<p>ラジオセクションから、Jazzチャンネルを選んでみるも音が聞こえず。
ボリューム設定が０になって様で、プチプチと音量を上げる。。</p>

<p>おっっ、聞こえた。<br />
わっ、しかも期待したより音が良い！</p>

<p>ちょっと幸せかもしれん。。もう嬉しくて、目から鼻血が出そうです。</p>

<p>いやぁ、このラズベリーパイは本当ご機嫌だねぇ。。</p>

<p>来週にはRPiB3が届きます。こちらは、ノマドサーバーになる予定です。そして、ノマドルーターもシンガポールからタイに向けて発送中。</p>

				

<h3>See Also</h3>
<ul>
	
	<li><a href="/blog/2019/03/mi-temperature-monitor/">Xiaomi 気温湿度計</a></li>
	
</ul>


            </div>
       		
			<div class="post-content">
       	 		<div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "goozenlabgh" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
       		</div>
            
        </div>
	</div>
    <div class="pure-u-1-24 pure-u-md-5-24"></div>
</div>


<div class="footer pure-g">
    <div class="pure-u-1-24 pure-u-md-3-24"></div>
    <div class="pure-u-11-12 pure-u-md-20-24">
        <div class="footer-content">
 		  <div class="pure-menu pure-menu-horizontal">
              <ul>







			      
                  <li class="pure-menu-heading" id="foot-name">Jin K.:</li>
                  

                  
                  <li class="pure-menu-item">
                      <a href="mailto:jin@goozenlab.com" class="pure-menu-link">Email</a>
                  </li>
                  

                  

                  

                  

                  
                  <li class="pure-menu-item">
                      <a href="https://twitter.com/goozenlab" class="pure-menu-link">Twitter</a>
                  </li>
                  
              </ul>
              <a href="#" class="pure-menu-heading pull-right" id="gototop-btn">↑↑</a>
          </div>
		  
		  <p id="foot-copyright">Copyright 2018, goozenlab; all rights reserved.</p>
		  
		</div>
      <div class="pure-u-1-24 pure-u-md-1-24"></div>
</div>


<script src="https://goozenlab.com/js/jquery.min.js" type="text/javascript"></script>
<script src="https://goozenlab.com/js/jquery.timeago.js" type="text/javascript"></script>
<script type="text/javascript">
  $(function(){
    $("time.timeago").timeago();
  })
  $("#toggle-btn").click(function(){
    $("#toggle-content").toggle();
    if($(this).html() === "☰") {
        $(this).html("X")
    } else {
        $(this).html("☰")
    }
  });
  $(window).resize(function(){
    if(window.innerWidth > 768) {
      $(".desktop").removeAttr("style");
    }
  });
</script>



</body>
</html>



