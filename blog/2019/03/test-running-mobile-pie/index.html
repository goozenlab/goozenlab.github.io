<!DOCTYPE html>
<html lang="en">
<head>

  
  <meta charset="utf-8">
  <title>パイ力がつきるまで | goozenlab</title>
  <meta name="description" content="">
  <meta name="author" content="jin">
  
<meta name="viewport" content="width=device-width, initial-scale=1">







<link rel="stylesheet" href="https://unpkg.com/purecss@1.0.0/build/pure-min.css" integrity="sha384-nn4HPE8lTHyVtfCBi5yW9d20FjT8BJwUXyWZT9InLYax14RDjBj46LmSztkmNP9w" crossorigin="anonymous">


  <link rel="stylesheet" href="https://unpkg.com/purecss@1.0.0/build/grids-responsive-min.css">

<link rel="stylesheet" href="https://goozenlab.com/css/custom.css">


<link rel="shortcut icon" href="https://goozenlab.com//img/favicon.ico" type="image/x-icon">



<script async src="https://www.googletagmanager.com/gtag/js?id=UA-125185379-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-125185379-1');
</script>

  

<link rel="stylesheet" href="https://goozenlab.com/highlight/styles/atom-one-dark.css">

<script src="https://goozenlab.com/highlight/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>



<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-4562670868665621",
          enable_page_level_ads: true
     });
</script>



 
</head>
<body>

<div class="header pure-g">
    <div class="pure-u-1-24 pure-u-md-2-24"></div>
    <div class="pure-u-11-12 pure-u-md-21-24">
        <div class="desktop pure-menu pure-menu-horizontal nav-menu">
            
            <a href="https://goozenlab.com/" class="site-title pure-menu-heading">goozenlab</a>
            <ul class="pure-menu-list pull-right">
				
                <li class="pure-menu-item">
                    <a href="https://goozenlab.com/tags/update/" class="pure-menu-link">update</a>
                </li>
                
                <li class="pure-menu-item pure-menu-has-children pure-menu-allow-hover">
					<a href="#" id="menuLink1" class="pure-menu-link">iapps</a>
					<ul class="pure-menu-children">
						<li class="pure-menu-item"><a href="https://goozenlab.com/iapp/littlist/" class="pure-menu-link">littlist</a></li>
						<li class="pure-menu-item"><a href="https://goozenlab.com/iapp/sati/" class="pure-menu-link">sati</a></li>
                		<li class="pure-menu-item"><a href="https://goozenlab.com/iapp/dandori/" class="pure-menu-link">dandori</a></li>
                		<li class="pure-menu-item"><a href="https://goozenlab.com/iapp/ohayo/" class="pure-menu-link">ohayo</a></li>
                		<li class="pure-menu-item"><a href="https://goozenlab.com/iapp/cosper/" class="pure-menu-link">cosper</a></li>
                		<li class="pure-menu-item"><a href="https://goozenlab.com/iapp/doop/" class="pure-menu-link">doop</a></li>
                		<li class="pure-menu-item"><a href="https://goozenlab.com/iapp/tapas/" class="pure-menu-link">tapas</a></li>
            		</ul>
        		</li>
                <li class="pure-menu-item">
                    <a href="https://goozenlab.com/about/" class="pure-menu-link">about</a>
                </li>
            </ul>
        </div>
        <div class="mobile pure-menu nav-menu">
            <a href="/" class="pure-menu-heading" id="toggle-home">goozenlab</a>
            <a href="#" id="toggle-btn">&#9776;</a>
            <ul class="pure-menu-list" id="toggle-content" style="display:none;">
                
				
                <li class="pure-menu-item">
                    <a href="https://goozenlab.com/categories/develop/" class="pure-menu-link">dev</a>
                </li>
                <li class="pure-menu-item">
                    <a href="https://goozenlab.com/categories/update/" class="pure-menu-link">update</a>
                </li>
                <li class="pure-menu-item">
                    <a href="https://goozenlab.com/categories/goods/" class="pure-menu-link">goods</a>
                </li>
                <li class="pure-menu-item">
                    <a href="https://goozenlab.com/categories/nomad/" class="pure-menu-link">nomad</a>
                </li>
                <li class="pure-menu-item">
                    <a href="https://goozenlab.com/about/" class="pure-menu-link">about</a>
                </li>
            </ul>
        </div>
    </div>
    <div class="pure-u-1-24 pure-u-md-1-24"></div>
</div>


<div class="pure-g">
    <div class="pure-u-1-24 pure-u-md-5-24"></div>
	<div class="pure-u-11-12 pure-u-md-14-24">
        <div class="post">
            <div class="post-title">
                <p class="footnote">
                    <time class="">2019-03-25</time>
		            
                    
                    |
                    
                    
                    tags:<a href="https://goozenlab.com/tags/raspberry-pi">raspberry pi</a> 
                    

                    
                    categories:<a href="https://goozenlab.com/categories/server">server</a> 
                    

                    
                </p>
                <h1>パイ力がつきるまで</h1>
            </div>

            <div class="post-content">
                

<p>数年ぶりの選挙があったこの週末は、飲み屋も閉まってたりで、街がしーーーんと、すごく静かでした。さて、さて、これからどうなることやら。。（北部タイにて）</p>

<p>さて、手元にあるラズパイ２機（パイ３BとゼロW）をモバイル・バッテリーで動かしてみて、稼働時間ををちょっと測ってみました。</p>

<p><img src="/images/2019-03-24-running-mobile-pie.jpg" alt="Pi Running with M. Batttery" /></p>

<p>使用したのはシャオミの行動電源10,00mAh高配版（グレーの物）、USBの出力口が二つ付いていればルーターとセットで測りたかったのですが、一つしか付いていないので、パイの稼働時間のみの測定しました。</p>

<p>計測方法はいたって簡易的に、シンプルな二つのシェル・スクリプトをcronで走らせて行いました。</p>

<pre><code># crontab -e

@reboot /root/task_on_reboot.sh
* * * * * /root/update_uptime.sh
</code></pre>

<p>あまりお忙しそうではないので、1分おきに生きているかどうかの確認をして、リブートした時に最後の書き置きをコピーするという段取りです。</p>

<p>スクリプトは以下の：<code>update_uptime.sh</code>と<code>task_on_reboot.sh</code>を使いました。</p>

<pre><code>#!/bin/sh
# update_uptime.sh

uptime &gt; /root/uptime.log
</code></pre>

<pre><code>#!/bin/sh
# task_on_reboot.sh

cat /root/uptime.log &gt;&gt; /root/reboot.log
echo &quot;Reboot @ $(date)&quot; &gt;&gt; /root/reboot.log
</code></pre>

<p>両機種ともアドブロッカーのパイ・ホールを入れてます。パイ３BではGrafana、influxdb、telegrafなどが後ろで動いています。</p>

<p>バッテリーが少なくなると、だんだんLEDの点滅間隔が遅くなっているような。。。。</p>

<h2 id="結果">結果</h2>

<h3 id="1-pie-zero-w-dietpi">1. Pie Zero W (DietPi)</h3>

<p><strong>2日と2時間50分</strong> 約50時間と大健闘。</p>

<p>Piholeと検証用のnextCloudしか動いてなくて、そんなに仕事量が多く無いというのもありますが、思いの外持ちました。より小さい、モバイルバッテリーでルーターをつけても1日はもつ感じです。ルーターをつけても、1日は外に出ていても問題はない。</p>

<p>音楽用の持ち歩き端末でもいいかなと、手持ちのMi Max3とUSBでテザリングができれば、電源も取れるし、バッテリーフリーの音楽サーバーになるってことか？ちょっと夢が広がる使い方ができるかもしれん。（まぁ、スマートフォンで全部できるのだけどね。）</p>

<pre><code>Booted
 05:10:01 up  8:24,  1 user,  load average: 0.09, 0.15, 0.11
Reboot @ Wed 20 Mar 11:16:51 +07 2019
 11:29:01 up 6:15,  1 user,  load average: 0.14, 0.27, 0.18
Reboot @ Wed 20 Mar 11:30:11 +07 2019
 23:43:01 up 1 day, 12:13,  0 users,  load average: 0.26, 0.28, 0.27
-----
</code></pre>

<p>現在：ドロップボックスの代替として、NextCloud・ローカル貯蔵庫として運用中です。携帯で撮った写真の保存先として試験運用（ドロップボックスがねぇ、、）。</p>

<h3 id="2-pi-3b-debian-buster-w-64bit-kernel">2. Pi 3B (debian.buster w/ 64bit Kernel)</h3>

<p><strong>22時間30分</strong>、と１日に届きませんでした。Pie Zero Wのほぼ半分。倍の電力でスピードも倍以上。</p>

<p>ラズビアンをベースに64bit化したシステムの
<a href="https://wiki.debian.org/RaspberryPi3">raspberry-pi-3-buster-PREVIEW</a>
に、ビルドしたカーネルを付けて動かしてます。</p>

<p>細かい調整はしてませんし、cpufreqがうまく働いていないようで、モードを変えても、 &ldquo;ondemand&rdquo;にしばししたら切り替わるようで、ほぼ、1.2Ghzに固定され動作してました。CPUは数パーセントしか使っていない。
他にバックグラウンドで Grafana + Influxdb + telegraf が動いています。途中でアクセスポイントのソフトを入れたりしました。多分、実際の使用環境ではアクセス・ポイントとしても働いてもらうことになるので、これよりは短くなると思われます。また、環境が整ったら計測してみます。</p>

<p>できれば、もう一回り小さいモバイル・バッテリーで１日は持ってくれれば非常にハッピーになれるのだけどね。。</p>

<pre><code>Booted 
 17:19:01 up  6:53,  1 user,  load average: 0.17, 0.13, 0.05
Reboot @ Sat Mar 23 17:19:55 +07 2019
 03:21:01 up 10:17,  1 user,  load average: 0.00, 0.00, 0.02
Reboot @ Sun Mar 24 03:38:06 +07 2019
 09:13:01 up  5:22,  1 user,  load average: 0.07, 0.06, 0.02
Reboot @ Sun Mar 24 09:13:29 +07 2019
</code></pre>

<p><img src="/images/2019-03-24-grafana-working.png" alt="Grafana" />
[カーネル5ビルド中]</p>

<p>今後の追加予定：
BTで、気温計のログを取って、Grafanaでモニターリング。いずれ、スマートウォッチと連動させて、健康ログを作りたい。</p>

<hr />

<p>やはり、ゼロは消費電力が少ないです。少し調整すればもう少しは持ちそうですし、３Bもなかなか健闘してると思います。
いずれにせよ、処理能力の違いを考えたら妥当な結果でもある。</p>

<p>購入時に３Bか３B＋のどちらにするか少々悩みましたが、3B+にしたら消費電力がさらに上がるとのことなので、
３Bは私の利用目的から考えたらこの選択は、グッチョイでした。そして、バッテリーはアウトレット -&gt; モバイル・バッテリ -&gt; RPi 3Bで繋いでも、充電ができました。</p>

<p>でも、ほとんど、処理に負担のかかる作業はしていないので、逆に周波数を下げ、幅をもたせて運用しても良いかも、ちょっと１回クロックを下げて（800 &lt;-&gt; 300とか）テストしてみても良いかなと思ったりしてます。</p>

<p>時間や用途に合わせて調整することもできそうです。</p>

<p>個人的にはルーターをつけた状態で20時間を最低限の設定にして、色々調整していきたいと思います。</p>

<p>さて、日本はそろそろ桜のシーズンなんですよね。ちょっと、日本が恋しくなる時期。こちらは酷暑、、インドに向かうもあちらも酷暑。</p>

				

<h3>See Also</h3>
<ul>
	
	<li><a href="/blog/2019/03/pi-archlinux64-withdrawal/">ArchLinux: RPi B3 玉砕</a></li>
	
	<li><a href="/blog/2019/03/docker-install-buster/">Docker on RPi3B.arm64.buster</a></li>
	
	<li><a href="/blog/2019/03/hostapd-buster/">アクセスポイント</a></li>
	
	<li><a href="/blog/2019/03/pi-archlinux64-install/">ArchLinuxをRaspberry Pi B3にインストール</a></li>
	
	<li><a href="/blog/2019/03/install-dietpi/">DietPiのインストール</a></li>
	
</ul>


            </div>
       		
			<div class="post-content">
       	 		<div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "goozenlabgh" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
       		</div>
            
        </div>
	</div>
    <div class="pure-u-1-24 pure-u-md-5-24"></div>
</div>


<div class="footer pure-g">
    <div class="pure-u-1-24 pure-u-md-3-24"></div>
    <div class="pure-u-11-12 pure-u-md-20-24">
        <div class="footer-content">
 		  <div class="pure-menu pure-menu-horizontal">
              <ul>







			      
                  <li class="pure-menu-heading" id="foot-name">Jin K.:</li>
                  

                  
                  <li class="pure-menu-item">
                      <a href="mailto:jin@goozenlab.com" class="pure-menu-link">Email</a>
                  </li>
                  

                  

                  

                  

                  
                  <li class="pure-menu-item">
                      <a href="https://twitter.com/goozenlab" class="pure-menu-link">Twitter</a>
                  </li>
                  
              </ul>
              <a href="#" class="pure-menu-heading pull-right" id="gototop-btn">↑↑</a>
          </div>
		  
		  <p id="foot-copyright">Copyright 2018, goozenlab; all rights reserved.</p>
		  
		</div>
      <div class="pure-u-1-24 pure-u-md-1-24"></div>
</div>


<script src="https://goozenlab.com/js/jquery.min.js" type="text/javascript"></script>
<script src="https://goozenlab.com/js/jquery.timeago.js" type="text/javascript"></script>
<script type="text/javascript">
  $(function(){
    $("time.timeago").timeago();
  })
  $("#toggle-btn").click(function(){
    $("#toggle-content").toggle();
    if($(this).html() === "☰") {
        $(this).html("X")
    } else {
        $(this).html("☰")
    }
  });
  $(window).resize(function(){
    if(window.innerWidth > 768) {
      $(".desktop").removeAttr("style");
    }
  });
</script>



</body>
</html>



